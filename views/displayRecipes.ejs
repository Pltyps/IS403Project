<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipes</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Lobster&family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/styles.css">
    <script>
        // Function to toggle favorites
        async function toggleFavorite(recipeId, isFavorite) {
            try {
                const response = await fetch("/favorites/toggle", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        userid: 1, // Replace with the actual logged-in user's ID
                        recipeid: recipeId,
                        isFavorite: isFavorite
                    }),
                });

                if (!response.ok) {
                    alert("Failed to update favorite status");
                }
            } catch (error) {
                console.error("Error toggling favorite:", error);
            }
        }
    </script>
</head>
<body>
    <!-- Dropdown for categories -->
    <form action="/recipes" method="GET">
        <label for="category">Filter by Category:</label>
        <select name="category" id="category" onchange="this.form.submit()">
            <option value="">All Categories</option>
            <% categories.forEach(category => { %>
                <option value="<%= category.categoryid %>" <%= category.categoryid == selectedCategory ? 'selected' : '' %>>
                    <%= category.catname %>
                </option>
            <% }); %>
        </select>
    </form>

    <ul>
        <% recipes.forEach(recipe => { %>
            <li>
                <h2><%= recipe.recipename %></h2>
                <p><strong>Category:</strong> <%= recipe.category_name %></p>
                <p><strong>Description:</strong> <%= recipe.description %></p>
                <p><strong>Cook Time:</strong> <%= recipe.cooktime %></p>
                <p><strong>Prep Time:</strong> <%= recipe.preptime %></p>
                <p><strong>Servings:</strong> <%= recipe.servings %></p>

                <h3>Ingredients:</h3>
                <ul>
                    <% recipe.ingredients.forEach(ingredient => { %>
                        <li>
                            <%= ingredient.amount %> <%= ingredient.unit_name %> of <%= ingredient.ingredient_name %>
                        </li>
                    <% }); %>
                </ul>

                <h3>Instructions:</h3>
                <ol>
                    <% recipe.instructions.forEach(instruction => { %>
                        <li>
                            <%= instruction.instdesc %>
                        </li>
                    <% }); %>
                </ol>

                <!-- Checkbox for marking/unmarking favorite -->
                <label>
                    <input 
                        type="checkbox" 
                        <% if (recipe.isFavorite) { %> checked <% } %>
                        onchange="toggleFavorite(<%= recipe.recipeid %>, <%= recipe.isFavorite ? 'true' : 'false' %>)"
                    >
                    Favorite
                </label>
            </li>
        <% }); %>
    </ul>
</body>
</html>